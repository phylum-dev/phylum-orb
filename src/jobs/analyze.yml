description: >
  Run Phylum Analysis

docker:
  - image: phylumio/phylum-ci

parameters:
  api_key:
    type: string
    description: "Phylum API key (https://app.phylum.io/tokens/list)"

steps:
  - checkout
  - run:
      name: Set Head
      command: >
        apt-get install openssh-client
        git remote set-head origin --auto
  - run:
      name: Print Phylum version
      command: phylum --version
  - run:
      name: Analyze latest commit
      command: phylum-ci -k << parameters.api_key >>
